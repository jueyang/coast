<!DOCTYPE html>
<html>
<head>
<<<<<<< HEAD
 	<meta charset='UTF-8'/>
 	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
 	<title>Strokes of the Oregonian Coast</title>
	<link href='https://api.tiles.mapbox.com/mapbox.js/v2.0.0/mapbox.css' rel='stylesheet' />
	<link rel='stylesheet' href='css/reset.css' type='text/css' />
	<link rel='stylesheet' href='css/style.css' type='text/css' />
	<link href='http://fonts.googleapis.com/css?family=Homemade+Apple|Crimson+Text:400italic' rel='stylesheet' type='text/css'>
</head>
<body>
	<div id='map'></div>
	<ul class='controller'>
		<li class='fader'>&#9675;</li>
		<li class='looper'>&#9657;</li>
	</ul>
	<div class='open fadeIn animated'>
		<h1>Strokes of Ocean</h1>
		<p>This is my recollection of the ocean cooled by water from the North . Of the gusts of wind on that crisp, sunny day, damp footprints of the dog,  S'mores falling onto the sand, and the old man who gave me a giant piece of agate without uttering a word.</p>
	</div>
  	<script src='js/jquery-1.7.2.min.js' type='text/javascript'></script>
    <script src='js/app.js' type='text/javascript'></script>
  	<script src='https://api.tiles.mapbox.com/mapbox.js/v2.0.0/mapbox.js'></script>
  	<script>
  		L.mapbox.accessToken = 'pk.eyJ1IjoianVlIiwiYSI6InFsakR2UEkifQ.GSsNWZF7HVlLqwdhWuM2gA';

  		var map = L.mapbox.map('map', 'jue.map-9f0twc3h',{
  			minZoom:6,
  			maxZoom:9,
  			zoomControl: false
  		}).setView([43.5, -128], 7);

  		var dot = L.icon({
		    iconUrl: 'images/blurred-dot.png',
		    iconSize: [100,100]
		});

		var layerGroup = L.layerGroup(),
			activeStory = false;

  		var townLayers = L.geoJson(app.towns,{
  			pointToLayer: function(feature,latlng){
				return L.marker(latlng, {icon: dot});
  			},
  			onEachFeature: function(feature,layer){
  				var title = '<h1>' + feature.properties.name + '</h1>';
  					paragraph = '<p>' + feature.properties.story + '</p>',
  					all = '<div class="story">' + title + paragraph + '</div>';

  				// popup of both town name and story - for click
  				feature.properties.all = L.popup({
  						closeButton: false,
  						keepInView: true,
  						offset: [-300,100]
  					})
  					.setContent(all)
  					.setLatLng(layer.getLatLng());

	  			layer.on('click',function(){
	  				map.openPopup(feature.properties.all);

	  				$('.open').removeClass('fadeIn');
	  				$('.open').addClass('fadeOut');
	  				$('.fader').addClass('blink');

	  				activeStory = feature.properties.id;
	  			}).addTo(layerGroup);
  			}
  		}).addTo(map);

		$('.fader').bind('click',function(){
			$('.open').toggleClass('fadeIn fadeOut');
			$('.fader').toggleClass('blink');
		});
		$('.looper').bind('click',toNextStory);


		function toNextStory(){

			var next;
			if (!activeStory || activeStory >= layerGroup.getLayers().length){
				next = 1;
			} else if (activeStory < layerGroup.getLayers().length){
				next = activeStory + 1;
			}

		    layerGroup.eachLayer(function(layer) {
		        if (layer.feature.properties.id === next) {
		            nextStory = layer.feature.properties.all;
		            map.setView(layer.getLatLng(), layer.feature.properties.zoom);
		            map.openPopup(nextStory);

		            paragraphOpen = true;
		           	activeStory = next;
		        }
		    });

		}

		map.on('popupopen',function(){
	  		$('.open').removeClass('fadeIn');
			$('.open').addClass('fadeOut');
			$('.fader').addClass('blink');
		})

  	</script>
</body>
</html>